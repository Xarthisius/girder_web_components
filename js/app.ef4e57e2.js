(function(e){function t(t){for(var a,o,n=t[0],l=t[1],c=t[2],u=0,p=[];u<n.length;u++)o=n[u],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&p.push(r[o][0]),r[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);d&&d(t);while(p.length)p.shift()();return i.push.apply(i,c||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],a=!0,n=1;n<s.length;n++){var l=s[n];0!==r[l]&&(a=!1)}a&&(i.splice(t--,1),e=o(o.s=s[0]))}return e}var a={},r={app:0},i=[];function o(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=a,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(s,a,function(t){return e[t]}.bind(null,a));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],l=n.push.bind(n);n.push=t,n=n.slice();for(var c=0;c<n.length;c++)t(n[c]);var d=l;i.push(["a1ec","chunk-vendors"]),s()})({"01f8":function(e,t,s){},"0e3a":function(e,t,s){"use strict";var a=s("8991"),r=s.n(a);r.a},"23cb":function(e,t,s){"use strict";var a=s("8ff5"),r=s.n(a);r.a},"28e0":function(e,t,s){"use strict";var a=s("84c2"),r=s.n(a);r.a},"3ccc":function(e,t,s){"use strict";var a=s("59b6"),r=s.n(a);r.a},4021:function(e,t,s){"use strict";var a=s("a662"),r=s.n(a);r.a},"406f":function(e,t,s){},"59b6":function(e,t,s){},"84c2":function(e,t,s){},8991:function(e,t,s){},"8d4c":function(e,t,s){"use strict";var a=s("a033"),r=s.n(a);r.a},"8ff5":function(e,t,s){},"97f4":function(e,t,s){},"98e3":function(e,t,s){},a033:function(e,t,s){},a1ec:function(e,t,s){"use strict";s.r(t);var a=s("a026"),r=s("3003"),i=s("f309"),o=(s("41e6"),s("bf40"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-card",{staticClass:"girder-authentication-component"},[s("v-tabs",{attrs:{"background-color":"primary",dark:""},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[s("v-tabs-slider",{attrs:{color:"yellow"}}),s("v-tab",{key:"login"},[e._v("Log In")]),e.register?s("v-tab",{key:"registration"},[e._v("Register")]):e._e()],1),s("v-tabs-items",{model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[s("v-tab-item",{key:"login-box"},[s("girder-login",e._b({attrs:{"oauth-providers":e.oauthProviders},on:{forgotpassword:function(t){return e.$emit("forgotpassword")}}},"girder-login",{forceOtp:e.forceOtp,forgotPasswordUrl:e.forgotPasswordUrl,forgotPasswordRoute:e.forgotPasswordRoute,hideForgotPassword:e.hideForgotPassword},!1))],1),e.register?s("v-tab-item",{key:"registration-box"},[s("girder-registration",{attrs:{"oauth-providers":e.oauthProviders}})],1):e._e()],1)],1)}),n=[],l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login-widget"},[e._l(e.alerts.errors,function(t){return s("v-alert",{key:t,staticClass:"mt-0",attrs:{dismissible:"",transition:"scale-transition",value:!!t,type:"error"}},[e._v(e._s(t))])}),s("v-container",[s("v-form",{ref:"login",on:{submit:function(t){return t.preventDefault(),e.login(t)}}},[!e.otpFormVisible||e.forceOtp?s("v-text-field",{attrs:{label:"Username or e-mail",autofocus:"",rules:e.nonEmptyRules,"prepend-icon":"$vuetify.icons.user",type:"text"},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}):e._e(),!e.otpFormVisible||e.forceOtp?s("v-text-field",{attrs:{type:"password",label:"Password",rules:e.nonEmptyRules,"prepend-icon":"$vuetify.icons.lock"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}):e._e(),e.otpFormVisible||e.forceOtp?s("v-text-field",{attrs:{type:"text",label:"Authentication code",rules:e.otpRules,"prepend-icon":"$vuetify.icons.otp"},model:{value:e.otp,callback:function(t){e.otp=t},expression:"otp"}}):e._e(),s("v-card-actions",[s("v-btn",{staticClass:"ml-0",attrs:{type:"submit",color:"primary",disabled:e.inProgress,loading:e.inProgress}},[s("v-icon",{attrs:{left:""}},[e._v("$vuetify.icons.login")]),e._v(e._s(e.otpFormVisible?"Verify code":"Login"))],1),e.hideForgotPassword?e._e():[s("v-spacer"),s("v-btn",{attrs:{text:"",color:"primary",to:e.forgotPasswordRoute,href:e.forgotPasswordUrl},on:{click:function(t){return e.$emit("forgotpassword")}}},[e._v("Forgot Password?")])]],2)],1)],1),e.oauthProviders&&e.oauthProviders.length?[s("v-divider"),s("girder-oauth",{attrs:{providers:e.oauthProviders}})]:e._e()],2)},c=[],d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",{staticClass:"oauth-widget"},[s("h4",[e._v("Or "+e._s(e.verb)+" with OAuth")]),e._l(e.providers,function(t){return s("v-btn",{key:t.id,staticClass:"ml-0 mr-3",attrs:{dark:e.iconMap[t.id].dark,color:e.iconMap[t.id].color,href:t.url}},[s("v-icon",{attrs:{left:""}},[e._v(e._s(e.$vuetify.icons.values[e.iconMap[t.id].icon]))]),e._v(e._s(t.name))],1)})],2)},u=[];const p={github:{dark:!0,icon:"github"},google:{dark:!0,icon:"google",color:"#3367d6"},linkedin:{dark:!0,icon:"linkedin",color:"#283e4a"},bitbucket:{dark:!1,icon:"bitbucket"},box:{dark:!0,icon:"box_com",color:"#0071f7"},globus:{dark:!0,icon:"globus",color:"#335a95"}};var h={props:{verb:{type:String,default:"sign in"},providers:{type:Array,required:!0}},data(){return{enabledProviders:[],iconMap:p}}},m=h,f=s("2877"),g=s("6544"),v=s.n(g),b=s("8336"),y=s("a523"),w=s("132d"),_=Object(f["a"])(m,d,u,!1,null,null,null),x=_.exports;v()(_,{VBtn:b["a"],VContainer:y["a"],VIcon:w["a"]});const k="authentication must include a one-time password",C=[e=>!!e||"Item is required"],$=[e=>{const t="6 digit number";try{return parseInt(e,10)&&6===String(e).length||t}catch(s){return t}}];var S={inject:["girderRest"],components:{GirderOauth:x},props:{forceOtp:{type:Boolean,default:!1},forgotPasswordUrl:{type:String,default:null},forgotPasswordRoute:{type:Object,default:null},hideForgotPassword:{type:Boolean,default:!1},oauthProviders:{type:Array,default:()=>[]}},data(){return{username:"",password:"",otp:null,inProgress:!1,alerts:{errors:[]},nonEmptyRules:C,otpRules:$,otpFormVisible:!1}},methods:{async login(){if(this.$refs.login.validate()){this.alerts.errors=[],this.inProgress=!0;try{await this.girderRest.login(this.username,this.password,this.otp),this.password="",this.otp=null,this.otpFormVisible=!1}catch(e){if(!e.response||401!==e.response.status)throw this.alerts.errors.push("Unknown error."),e;{const{message:t}=e.response.data;t&&t.indexOf(k)>=0?(this.otp=null,this.otpFormVisible=!0,this.$refs.login.resetValidation()):this.alerts.errors.push(t||"Unauthorized.")}}finally{this.inProgress=!1}}}}},T=S,R=s("0798"),V=s("99d9"),j=s("ce7e"),O=s("4bd4"),P=s("2fa4"),E=s("8654"),I=Object(f["a"])(T,l,c,!1,null,null,null),L=I.exports;v()(I,{VAlert:R["a"],VBtn:b["a"],VCardActions:V["a"],VContainer:y["a"],VDivider:j["a"],VForm:O["a"],VIcon:w["a"],VSpacer:P["a"],VTextField:E["a"]});var F=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"register-widget"},[e._l(e.alerts.errors,function(t){return s("v-alert",{key:t,staticClass:"mt-0",attrs:{dismissible:"",transition:"scale-transition",value:!0,type:"error"}},[e._v(e._s(t))])}),e._l(e.alerts.infos,function(t){return s("v-alert",{key:t,staticClass:"mt-0",attrs:{dismissible:"",transition:"scale-transition",value:!0,type:"info"}},[e._v(e._s(t))])}),s("v-container",[s("v-form",{ref:"form",on:{submit:function(t){return t.preventDefault(),e.register(t)}}},[s("v-text-field",{attrs:{label:"Username",rules:e.nonEmptyRules,type:"text",autofocus:""},model:{value:e.login,callback:function(t){e.login=t},expression:"login"}}),s("v-text-field",{attrs:{label:"Email",rules:e.nonEmptyRules,type:"email"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),s("v-text-field",{attrs:{label:"First Name",rules:e.nonEmptyRules,type:"text"},model:{value:e.firstName,callback:function(t){e.firstName=t},expression:"firstName"}}),s("v-text-field",{attrs:{label:"Last Name",rules:e.nonEmptyRules,type:"text"},model:{value:e.lastName,callback:function(t){e.lastName=t},expression:"lastName"}}),s("v-text-field",{attrs:{type:"password",label:"Password",rules:e.nonEmptyRules},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),s("v-text-field",{attrs:{type:"password",label:"Retype password",rules:e.retypeMustMatchPasswordRules},model:{value:e.retypePassword,callback:function(t){e.retypePassword=t},expression:"retypePassword"}}),s("v-btn",{staticClass:"ml-0",attrs:{type:"submit",color:"primary",loading:e.inProgress}},[e._v("Register")])],1)],1),e.oauthProviders&&e.oauthProviders.length?[s("v-divider"),s("girder-oauth",{attrs:{verb:"register",providers:e.oauthProviders}})]:e._e()],2)},D=[],M={inject:["girderRest"],components:{GirderOauth:x},props:{oauthProviders:{type:Array,default:()=>[]}},data(){const e=[e=>!!e||"Item is required"],t=[...e,e=>e===this.password||"Passwords must match"];return{login:"",email:"",firstName:"",lastName:"",password:"",retypePassword:"",retypePasswordErrors:[],inProgress:!1,alerts:{errors:[],infos:[]},nonEmptyRules:e,retypeMustMatchPasswordRules:t}},methods:{async register(){if(this.$refs.form.validate()){this.inProgress=!0,this.alerts.errors=[],this.alerts.infos=[];try{const t=await this.girderRest.register(this.login,this.email,this.firstName,this.lastName,this.password);t.data.authToken||(this.alerts.infos.push("Registration needs email verification or administrator approval. \nCheck your email to continue."),this.$refs.form.reset())}catch(e){if(!e.response||400!==e.response.status)throw this.alerts.errors.push("Unknown error."),e;this.alerts.errors.push(e.response.data.message||"Invalid registration.")}finally{this.inProgress=!1}}}}},U=M,z=Object(f["a"])(U,F,D,!1,null,null,null),N=z.exports;v()(z,{VAlert:R["a"],VBtn:b["a"],VContainer:y["a"],VDivider:j["a"],VForm:O["a"],VTextField:E["a"]});var B=s("bc3a"),A=s.n(B),q=s("a78e"),G=s.n(q),J=s("4328");const K=64,W="#girderToken=",H="__",Q="Girder-Token",Y="Girder-OTP",X="Girder-Authorization";function Z(e){G.a.set("girderToken",e.token,{expires:new Date(e.expires)})}function ee(e){const t=e.hash.split(W),s=t[t.length-1].split(H)[0];if(s.length===K){const t=new Date;t.setDate((new Date).getDate()+365),Z({token:s,expires:t}),e.hash=e.hash.replace(`${W}${s}${H}`,"")}return s}class te extends a["a"]{constructor({apiRoot:e="/api/v1",token:t=G.a.get("girderToken")||ee(window.location),axios:s=A.a.create(),useGirderAuthorizationHeader:a=!1,setLocalCookie:r=!0}={}){super({data:{user:null,token:t}}),Object.assign(this,s,{apiRoot:e,setLocalCookie:r,useGirderAuthorizationHeader:a}),this.interceptors.request.use(e=>({...e,baseURL:this.apiRoot,headers:{[Q]:this.token,...e.headers}}))}async login(e,t,s=null){try{await this.logout()}catch(o){}let a;const r={[Q]:null};this.useGirderAuthorizationHeader?r[X]=`Basic ${window.btoa(`${e}:${t}`)}`:a={username:e,password:t},s&&(r[Y]=s);const i=await this.get("user/authentication",{headers:r,auth:a});return this.token=i.data.authToken.token,this.user=i.data.user,this.setLocalCookie&&Z(i.data.authToken),this.$emit("login",this.user),i}async logout(){if(this.token)try{await this.delete("user/authentication")}catch(e){if(401!==e.response.status)throw e}finally{this.token=null,this.user=null,G.a.remove("girderToken"),this.$emit("logout")}}async fetchUser(){const e=await this.get("user/me");return this.user=e.data,null===this.user&&(this.token=null),this.user}async register(e,t,s,a,r,i=!1){const o=await this.post("user",Object(J["stringify"])({login:e,email:t,firstName:s,lastName:a,password:r,admin:i}));return o.data.authToken?(this.token=o.data.authToken.token,this.user=o.data,this.setLocalCookie&&Z(o.data.authToken),this.$emit("register",this.user),this.$emit("login",this.user),o):o}}var se={inject:["girderRest"],components:{GirderLogin:L,GirderRegistration:N},props:{register:{type:Boolean,default:!1},oauth:{type:Boolean,default:!1},forgotPasswordUrl:{type:String,default:null},forgotPasswordRoute:{type:[Object,String],default:null},forceOtp:{type:Boolean,default:!1},hideForgotPassword:{type:Boolean,default:!1}},data(){return{activeTab:null}},asyncComputed:{async oauthProviders(){if(!this.oauth)return[];try{return(await this.girderRest.get("oauth/provider",{params:{redirect:`${window.location.href}${W}{girderToken}${H}`,list:!0}})).data}catch(e){return[]}}}},ae=se,re=s("b0af"),ie=s("71a3"),oe=s("c671"),ne=s("fe57"),le=s("aac8"),ce=s("9a96"),de=Object(f["a"])(ae,o,n,!1,null,null,null),ue=de.exports;v()(de,{VCard:re["a"],VTab:ie["a"],VTabItem:oe["a"],VTabs:ne["a"],VTabsItems:le["a"],VTabsSlider:ce["a"]});var pe=ue,he=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"girder-breadcrumb-component"},[e.girderRest.user&&!e.readonly?s("v-icon",{staticClass:"home-button mr-3",attrs:{color:"accent",disabled:e.location._id===e.girderRest.user._id},on:{click:function(t){return e.$emit("crumbclick",e.girderRest.user)}}},[e._v("$vuetify.icons.userHome")]):e._e(),s("v-breadcrumbs",{staticClass:"font-weight-bold pa-0",attrs:{items:e.breadcrumb},scopedSlots:e._u([{key:"item",fn:function(t){var a=t.item;return[s("v-breadcrumbs-item",{attrs:{tag:"a",disabled:e.readonly||e.breadcrumb.indexOf(a)==e.breadcrumb.length-1},on:{click:function(t){return e.$emit("crumbclick",a)}}},[-1!==["folder","user","collection"].indexOf(a.type)?[s("span",{staticClass:"accent--text"},[e._v(e._s(a.name))])]:"users"===a.type?[s("v-icon",{staticClass:"mdi-18px accent--text"},[e._v("$vuetify.icons.user")])]:"collections"===a.type?[s("v-icon",{staticClass:"mdi-18px accent--text"},[e._v("$vuetify.icons.collection")])]:"root"===a.type?[s("v-icon",{staticClass:"mdi-18px accent--text"},[e._v("$vuetify.icons.globe")])]:s("span",[e._v(e._s(a))])],2)]}}])},[s("span",{staticClass:"subheading font-weight-bold",attrs:{slot:"divider",disabled:e.readonly},slot:"divider"},[e._v("/")])])],1)},me=[];const fe={methods:{formatDate(e){const t=new Date(e);return t.toLocaleString()}}},ge={methods:{formatSize(e,{base:t=1024,unit:s="B"}={}){if(e<t)return`${e} ${s}`;let a,r=e;for(a=0;r>=t&&a<4;a+=1)r/=t;return`${r.toFixed(2)}  ${["","K","M","G","T"][a]}${s}`}}},ve={methods:{progressPercent(e){return e.total?Math.round(100*(e.current||0)/e.total):0}}},be={methods:{formatUsername(e){return`${e.firstName} ${e.lastName} (${e.login})`}}};var ye=s("fcf4"),we={theme:{dark:!1,themes:{light:{primary:ye["a"].lightBlue.darken1,secondary:ye["a"].blueGrey,accent:ye["a"].lightBlue.darken1,error:ye["a"].red,info:ye["a"].lightBlue.lighten1},dark:{primary:ye["a"].lightBlue.darken3,secondary:ye["a"].grey,accent:ye["a"].lightBlue.lighten1}}},icons:{iconfont:"mdi",values:{alert:"mdi-alert-circle",bitbucket:"mdi-bitbucket",box_com:"mdi-package",chevron:"mdi-chevron-right",circle:"mdi-checkbox-blank-circle",collection:"mdi-file-tree",download:"mdi-download",edit:"mdi-pencil",file:"mdi-file",fileMultiple:"mdi-file-multiple",fileNew:"mdi-file-plus",fileUpload:"mdi-file-upload",folder:"mdi-folder",folderNew:"mdi-folder-plus",github:"mdi-github-circle",globe:"mdi-earth",globus:"mdi-earth",google:"mdi-google",group:"mdi-account-multiple",item:"mdi-file",linkedin:"mdi-linkedin",lock:"mdi-lock",login:"mdi-login",logout:"mdi-logout",more:"mdi-dots-horizontal",otp:"mdi-shield-key",preview:"mdi-file-find",search:"mdi-magnify",settings:"mdi-tune",user:"mdi-account",userHome:"mdi-home-account",view:"mdi-eye"}}};class _e{constructor(e){Object.assign(this,e,{etags:{},offset:0,partNumber:1})}_finalizeMultipartXml(){const e=document.implementation.createDocument(null,null,null),t=e.createElement("CompleteMultipartUpload");return Object.entries(this.etags).forEach(([s,a])=>{const r=e.createElement("Part"),i=e.createElement("PartNumber"),o=e.createElement("ETag");i.appendChild(e.createTextNode(s)),o.appendChild(e.createTextNode(a)),r.appendChild(i),r.appendChild(o),t.appendChild(r)}),t.outerHTML}async _multiChunkUpload(){const{headers:e,method:t,url:s}=this.upload.s3.request,a=await A.a.request({data:null,headers:e,method:t,url:s}),r=(new DOMParser).parseFromString(a.data,"text/xml");return this.upload.s3.uploadId=r.querySelector("InitiateMultipartUploadResult > UploadId").textContent,this._sendChunks()}async _sendChunks(){const e=e=>this.progress({current:this.offset+e.loaded,total:this.file.size,indeterminate:!e.lengthComputable});while(this.offset<this.file.size){const t=this.file.slice(this.offset,this.offset+this.upload.s3.chunkLength),{method:s,url:a}=(await this.$rest.post("file/chunk",Object(J["stringify"])({chunk:JSON.stringify({contentLength:t.size,partNumber:this.partNumber,s3UploadId:this.upload.s3.uploadId}),offset:0,uploadId:this.upload._id}))).data.s3.request,r=await A.a.request({data:t,method:s,url:a,onUploadProgress:e});this.etags[this.partNumber]=r.headers.etag,this.partNumber+=1,this.offset+=t.size}this.progress({indeterminate:!0});const t=await this.$rest.post("file/completion",Object(J["stringify"])({uploadId:this.upload._id})),{headers:s,method:a,url:r}=t.data.s3FinalizeRequest;return await A.a.request({data:this._finalizeMultipartXml(),headers:s,method:a,url:r}),t.data}async start(){if(this.upload.s3.chunked)return this._multiChunkUpload();const{headers:e,method:t,url:s}=this.upload.s3.request;return await A.a.request({data:this.file,headers:e,method:t,url:s,onUploadProgress:e=>this.progress({current:e.loaded,total:this.file.size,indeterminate:!e.lengthComputable})}),this.progress({indeterminate:!0}),(await this.$rest.post("file/completion",Object(J["stringify"])({uploadId:this.upload._id}))).data}async resume(){return this.upload.s3.chunked?this._sendChunks():(this.upload.s3.request=(await this.$rest.get(`file/offset?uploadId=${this.upload._id}`)).data,this.start())}}class xe{constructor(e,{$rest:t,parent:s,progress:a=(()=>null)}={}){Object.assign(this,{$rest:t,file:e,parent:s,progress:a})}async start(){throw new Error("not implemented")}async resume(){return this.start()}beforeUpload(){}afterUpload(){}onError(e){}}const ke=67108864,Ce={s3:_e};class $e extends xe{constructor(e,{$rest:t,parent:s,progress:a=(()=>null),params:r={},chunkLen:i=ke}={}){super(e,{$rest:t,parent:s,progress:a}),Object.assign(this,{params:r,chunkLen:i,upload:null,offset:0,behavior:null})}async _sendChunks(){const e=e=>this.progress({indeterminate:!e.lengthComputable,current:this.offset+e.loaded,size:this.file.size});while(this.offset<this.file.size){const t=Math.min(this.offset+this.chunkLen,this.file.size),s=this.file.slice(this.offset,t),a=`file/chunk?offset=${this.offset}&uploadId=${this.upload._id}`;this.upload=(await this.$rest.post(a,s,{onUploadProgress:e,headers:{"Content-Type":"application/octet-stream"}})).data,this.offset=t}return this.upload}async start(){return this.upload=(await this.$rest.post("/file",Object(J["stringify"])({parentType:this.parent._modelType,parentId:this.parent._id,name:this.file.name,size:this.file.size,mimeType:this.file.type,...this.params}))).data,this.upload.behavior&&Ce[this.upload.behavior]?(this.behavior=new Ce[this.upload.behavior](this),this.behavior.start()):this._sendChunks()}async resume(){return this.upload?(this.progress({indeterminate:!0}),this.behavior?this.behavior.resume():(this.offset=(await this.$rest.get(`file/offset?uploadId=${this.upload._id}`)).data.offset,this._sendChunks())):this.start()}}class Se extends a["a"]{constructor(e=200){super({data(){return{flag:!1}}}),this.count=0,this.delay=e,this.timeout=null}inc(){this.count+=1,this.count>0&&this._toggleFlag(!0)}dec(){this.count=Math.max(0,this.count-1),0===this.count&&this._toggleFlag(!1)}_toggleFlag(e){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.flag=e},this.delay)}}function Te(e){return e._modelType||e.type}function Re(e){const t=Te(e);return["collections","users","root"].indexOf(t)>=0}function Ve(e){const t=Te(e);switch(t){case"collections":return"collection";case"users":return"user";default:return""}}function je(e){return t=>{return!!t&&(Re(t)?e:!!t._id)}}var Oe={props:{location:{type:Object,required:!0,validator:je(!0)},readonly:{type:Boolean,default:!1},append:{type:Array,default:()=>[]},rootLocationDisabled:{type:Boolean,default:!1}},inject:["girderRest"],data(){return{loading:!1}},computed:{breadcrumb(){const{append:e}=this;return[...this.pathBreadcrumb,...e]}},asyncComputed:{pathBreadcrumb:{default:[],async get(){this.loading=!0;const e=[],{rootLocationDisabled:t,girderRest:s,location:a}=this,{user:r}=s,i=Te(a),{name:o,_id:n}=a;if("folder"===i){if(o)e.unshift(this.extractCrumbData(a));else{const{data:t}=await this.girderRest.get(`folder/${n}`);e.unshift(this.extractCrumbData(t))}const{data:t}=await this.girderRest.get(`folder/${n}/rootpath`);t.reverse().forEach(t=>{e.unshift(this.extractCrumbData(t.object))})}else if("user"===i||"collection"===i){const{data:t}=await this.girderRest.get(`${i}/${n}`);e.unshift(this.extractCrumbData(t))}return t||(("users"===i||r&&e.length&&"user"===e[0].type)&&e.unshift({type:"users"}),("collections"===i||e.length&&"collection"===e[0].type)&&e.unshift({type:"collections"}),e.unshift({type:"root"})),this.loading=!1,e}}},created(){if(!je(!this.rootLocationDisabled)(this.location))throw new Error("root location cannot be used when root-location-disabled is true")},methods:{extractCrumbData(e){return{...e,type:e.type?e.type:e._modelType,name:"user"!==e._modelType?e.name:e.login}}}},Pe=Oe,Ee=(s("28e0"),s("2bc5")),Ie=s("f625"),Le=Object(f["a"])(Pe,he,me,!1,null,null,null),Fe=Le.exports;v()(Le,{VBreadcrumbs:Ee["a"],VBreadcrumbsItem:Ie["a"],VIcon:w["a"]});var De=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("girder-data-table",{staticClass:"girder-file-browser",attrs:{draggable:e.draggable,rows:e.rows,options:e.options,"server-items-length":e.serverItemsLength,loading:e.loading,selectable:e.internalSelectable},on:{"update:options":function(t){e.options=t},rowclick:e.rowClick,drag:function(t){return e.$emit("drag",t)},dragstart:function(t){return e.$emit("dragstart",t)},dragend:function(t){return e.$emit("dragend",t)},drop:function(t){return e.$emit("drop",t)}},scopedSlots:e._u([{key:"header",fn:function(t){var a=t.props,r=t.on;return[s("tr",{staticClass:"secondary",class:e.$vuetify.theme.dark?"darken-2":"lighten-5"},[e.internalSelectable?s("th",{staticClass:"pl-3 pr-0",attrs:{width:"1%"}},[s("v-checkbox",{staticClass:"pr-2",attrs:{color:"accent","hide-details":"","input-value":a.everyItem,indeterminate:e.internalValue.length>0&&!a.everyItem},nativeOn:{click:function(e){return r["toggle-select-all"](!a.everyItem)}}})],1):e._e(),s("th",{staticClass:"pl-3",attrs:{colspan:"10",width:"99%"}},[s("v-row",{staticClass:"ma-1"},[e._t("breadcrumb",null,null,{location:e.location,changeLocation:e.changeLocation,rootLocationDisabled:e.rootLocationDisabled}),s("v-spacer"),e._t("headerwidget",null,null,{location:e.location,changeLocation:e.changeLocation,rootLocationDisabled:e.rootLocationDisabled})],2)],1)])]}}],null,!0),model:{value:e.internalValue,callback:function(t){e.internalValue=t},expression:"internalValue"}})},Me=[],Ue=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-data-table",{staticClass:"girder-data-table",attrs:{"show-select":"","headers-length":4,value:e.value,options:e.options,items:e.rows,"server-items-length":e.serverItemsLength,loading:!!e.loading&&"accent","item-key":"_id"},on:{input:function(t){return e.$emit("input",t)},"update:options":function(t){return e.$emit("update:options",t)}},scopedSlots:e._u([{key:"header",fn:function(t){return[e._t("header",null,null,t)]}},{key:"item",fn:function(t){return[s("tr",{key:t.index,staticClass:"itemRow",class:e.getRowClass(t.item),attrs:{draggable:e.draggable,active:t.isSelected},on:{click:function(s){return e.handleRowSelect(s,t)},drag:function(s){return e.$emit("drag",{items:[t],event:s})},dragstart:function(s){return e.$emit("dragstart",{items:[t],event:s})},dragend:function(s){return e.$emit("dragend",{items:[t],event:s})},drop:function(s){return e.$emit("drop",{items:[t],event:s})}}},[e.selectable?s("td",{staticClass:"pl-3 pr-0"},[s("v-checkbox",{attrs:{"input-value":t.isSelected,accent:"","hide-details":""},on:{change:t.select}})],1):e._e(),s("td",{staticClass:"pl-3",attrs:{colspan:"2"}},[s("span",{staticClass:"text-container nobreak",class:e.getItemClass(t.item),on:{click:function(s){return s.stopPropagation(),e.$emit("rowclick",t.item)}}},[s("v-icon",{staticClass:"pr-2",attrs:{color:t.isSelected?"accent":""}},[e._v(e._s(e.$vuetify.icons.values[t.item.icon]))]),e._v(e._s(t.item.name))],1)]),s("td",{staticClass:"text-right nobreak"},[e._v(e._s(t.item.humanSize))])])]}},{key:"no-data",fn:function(){return[s("div",{staticClass:"text-center",attrs:{width:"100%"}},[e._v("No Data Available")])]},proxy:!0},{key:"no-results",fn:function(){return[s("div",{staticClass:"text-center",attrs:{width:"100%"}},[e._v("No Data Available")])]},proxy:!0}],null,!0)})},ze=[],Ne={props:{draggable:{type:Boolean,default:!1},loading:{type:Boolean,required:!0},options:{type:Object,required:!0},rows:{type:Array,required:!0},selectable:{type:Boolean,required:!0},serverItemsLength:{type:Number,required:!0},value:{type:Array,default:()=>[]}},data(){return{lastCheckBoxIdx:null}},methods:{getLocationType:Te,isRootLocation:Re,handleRowSelect({shiftKey:e},t){if(this.selectable){if(t.isSelected=!t.isSelected,e&&null!==this.lastCheckBoxIdx){const[e,s]=[this.lastCheckBoxIdx,t.index+1].sort(),a=this.rows.slice(e,s).filter(e=>void 0===this.value.find(t=>t._id===e._id));this.$emit("input",a.concat(this.value))}this.lastCheckBoxIdx=t.index}else this.$emit("rowclick",t.item)},getRowClass(e){const t=!this.selectable&&"folder"===Te(e)||Re(e)||"user"===Te(e);return{"select-cursor":t}},getItemClass(e){const t="item"!==Te(e);return{"select-cursor":t}}}},Be=Ne,Ae=(s("8d4c"),s("ac7c")),qe=s("8fea"),Ge=Object(f["a"])(Be,Ue,ze,!1,null,null,null),Je=Ge.exports;v()(Ge,{VCheckbox:Ae["a"],VDataTable:qe["a"],VIcon:w["a"]});const Ke="folder",We="item";var He={components:{GirderDataTable:Je},mixins:[ge],inject:["girderRest"],props:{draggable:{type:Boolean,default:!1},location:{type:Object,required:!0,validator:je(!0)},selectable:{type:Boolean,default:!1},noRootLocation:{type:Boolean,default:!1},upload:{type:Boolean,default:!1},rootLocationDisabled:{type:Boolean,default:!1},value:{type:Array,default:()=>[]}},data(){return{options:{itemsPerPage:10,page:1},internalRefreshCounter:0,rows:[],rowsLoading:!1,lazyValue:this.value||[]}},computed:{loading(){return this.rowsLoading},serverItemsLength(){return Object.values(this.counts).reduce((e,t)=>e+t,0)},internalSelectable(){return this.selectable&&this.location&&!Re(this.location)},internalValue:{get(){return this.lazyValue},set(e){this.lazyValue=e,this.$emit("input",e)}}},asyncComputed:{counts:{default:{nFolders:0,nItems:0,nUsers:0,nCollections:0},async get(){const e={nFolders:0,nItems:0,nUsers:0,nCollections:0},t=Te(this.location),{_id:s}=this.location;if(-1!==["folder","user","collection"].indexOf(t)){const{data:a}=await this.girderRest.get(`${t}/${s}/details`);return{...e,nFolders:a.nFolders||0,nItems:a.nItems||0}}if("users"===t||"collections"===t){const{data:s}=await this.girderRest.get(`${this.getResourceType(t)}/details`);return{...e,[Object.keys(s)[0]]:Object.values(s)[0]}}return"root"===t?{...e,nUsers:1,nCollections:1}:e},watch(){return[this.internalRefreshCounter,this.location,this.girderRest.user]}}},watch:{location(e){je(!this.rootLocationDisabled)(e)&&(this.options.page=1,this.internalValue=[])},value(e){this.lazyValue=e},async counts(){this.rows=await this.fetchPaginatedRows()},async options(){this.rows=await this.fetchPaginatedRows()}},created(){if(!je(!this.rootLocationDisabled)(this.location))throw new Error("root location cannot be used when root-location-disabled is true")},methods:{rowClick(e){this.$emit("rowclick",e),"item"!==Te(e)&&this.changeLocation(e)},changeLocation(e){const{location:t}=this,s=Te(e),a=Te(t);t._id===e._id&&a===s||this.$emit("update:location",e)},refresh(){this.selected=[],this.internalRefreshCounter+=1},async fetchPaginatedRows(){const{location:e,counts:t}=this;if(t.nFolders||t.nItems)return this.fetchPaginatedFolderRows();const s=Te(e);if("users"===s||"collections"===s){if(t.nUsers||t.nCollections){const t=Ve(e);return this.fetchPaginatedCollectionOrUserRows(t)}}else if("root"===s)return this.generateRootRows();return[]},async fetchPaginatedFolderRows(){this.rowsLoading=!0;const{counts:e,location:t,options:s}=this,{page:a,itemsPerPage:r}=s,i={parentType:t._modelType,parentId:t._id,limit:r>=0?r:null,offset:(a-1)*Math.abs(r)},o=e.nFolders>i.offset?r-(e.nFolders-i.offset):r,n=i.offset-e.nFolders,l={folderId:t._id,limit:r>=0?o:null,offset:n>0?n:0},c=[];c.push(this.girderRest.get(Ke,{params:i})),(l.limit>0||null===l.limit)&&"folder"===t._modelType&&c.push(this.girderRest.get(We,{params:l}));const d=(await Promise.all(c)).map(e=>e.data),u=[].concat.apply(...d).map(e=>({...e,humanSize:e.size?this.formatSize(e.size):"",icon:e._modelType in this.$vuetify.icons.values?e._modelType:"file"}));return this.rowsLoading=!1,u},async fetchPaginatedCollectionOrUserRows(e){this.rowsLoading=!0;const{page:t,itemsPerPage:s}=this.options,{data:a}=await this.girderRest.get(e,{params:{limit:s>=0?s:null,offset:(t-1)*s}}),r=a.map(e=>({...e,name:"user"===e._modelType?`${e.firstName} ${e.lastName}`:e.name,humanSize:e.size?this.formatSize(e.size):"",icon:e._modelType}));return this.rowsLoading=!1,r},generateRootRows(){const e=[{_modelType:"collections",name:"Collections",icon:"collection"}];return this.girderRest.user&&e.push({_modelType:"users",name:"Users",icon:"user"}),e},getResourceType(e){switch(e){case"collections":return"collection";case"users":return"user";default:return""}}}},Qe=He,Ye=s("0fd9"),Xe=Object(f["a"])(Qe,De,Me,!1,null,null,null),Ze=Xe.exports;v()(Xe,{VCheckbox:Ae["a"],VRow:Ye["a"],VSpacer:P["a"]});var et=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-card",{staticClass:"data-details"},[s("v-toolbar",{attrs:{flat:"",dark:"",dense:"",color:"primary"}},[s("v-toolbar-title",{staticClass:"subtitle-1"},[s("v-icon",{staticClass:"pr-2 mdi-18px"},[e._v(e._s(e.icon))]),e._v(e._s(e.title))],1),s("v-spacer"),e.datum?s("v-dialog",{attrs:{"max-width":"800px"},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[s("v-btn",e._g({attrs:{icon:""}},a),[s("v-icon",{staticClass:"mdi-18px"},[e._v(e._s(e.$vuetify.icons.edit))])],1)]}}],null,!1,830038601),model:{value:e.showUpsert,callback:function(t){e.showUpsert=t},expression:"showUpsert"}},[s("girder-upsert-folder",{key:e.datum._id,attrs:{edit:!0,location:e.datum},on:{dismiss:function(t){e.showUpsert=!1}}})],1):e._e()],1),e.details&&e.details.description?s("girder-markdown",{staticClass:"mx-3 mt-2",attrs:{text:e.details.description}}):e._e(),s("girder-detail-list",{attrs:{title:"Info",rows:e.info}}),e.meta.length?s("girder-detail-list",{attrs:{title:"Meta",rows:e.meta},scopedSlots:e._u([{key:"row",fn:function(t){return[s("v-row",{attrs:{justify:"space-between"}},[s("v-col",{staticClass:"shrink py-1 body-2 font-weight-bold"},[e._v(e._s(t.datum.key))]),s("v-col",{staticClass:"py-1 body-2 d-flex justify-end"},[e._v(e._s(t.datum.value))])],1)]}}],null,!1,1927103446)}):e._e(),e.files.length?s("girder-detail-list",{attrs:{title:"Files ("+e.files.length+")",rows:e.files}}):e._e(),e.actions.length?s("girder-detail-list",{attrs:{title:"Actions",clickable:!0,rows:e.actions},on:{click:e.handleAction},scopedSlots:e._u([{key:"row",fn:function(t){return[s("v-list-item-icon",{staticClass:"mr-1"},[s("v-icon",{staticClass:"pr-2",attrs:{color:t.datum.color}},[e._v(e._s(t.datum.icon||e.$vuetify.icons.values[t.datum.iconKey]))])],1),s("v-list-item-content",{class:t.datum.color+"--text"},[e._v(e._s(t.datum.name))])]}}],null,!1,2270599376)}):e._e()],1)},tt=[],st=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.rows.length?s("v-list",{attrs:{dense:""}},[s("v-subheader",{staticClass:"subtitle-1 font-weight-bold pl-4"},[e._v(e._s(e.title))]),e._l(e.rows,function(t,a){return[s("v-list-item",e._g({key:a,staticClass:"allow-select"},e.clickable?{click:function(){return e.$emit("click",t)}}:{}),[e._t("row",[s("v-list-item-content",[s("div",{staticClass:"body-2 no-overflow"},[e._v(e._s(t))])])],{datum:t})],2),a<e.rows.length-1?s("v-divider",{staticClass:"mx-3"}):e._e()]})],2):e._e()},at=[],rt={props:{title:{type:String,required:!0},rows:{type:Array,required:!0},clickable:{type:Boolean,default:!1}}},it=rt,ot=(s("e837"),s("8860")),nt=s("da13"),lt=s("5d23"),ct=s("e0c7"),dt=Object(f["a"])(it,st,at,!1,null,"076eca42",null),ut=dt.exports;v()(dt,{VDivider:j["a"],VList:ot["a"],VListItem:nt["a"],VListItemContent:lt["a"],VSubheader:ct["a"]});var pt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"g-md-viewer",domProps:{innerHTML:e._s(e.markdown)}})},ht=[],mt=s("d4cd"),ft=s.n(mt),gt={props:{text:{default:"",type:String}},computed:{markdown(){return ft()({linkify:!0}).render(this.text)}}},vt=gt,bt=(s("23cb"),Object(f["a"])(vt,pt,ht,!1,null,null,null)),yt=bt.exports,wt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-form",{on:{submit:function(t){return t.preventDefault(),e.upsert(t)}}},[s("v-card",{attrs:{flat:""}},[s("v-row",{staticClass:"pa-2 flex-column",attrs:{"no-gutters":""}},[e._t("header",[s("v-card-title",{staticClass:"pb-0",attrs:{"primary-title":""}},[s("h5",{staticClass:"display-1"}),e._v(e._s(e.edit?"Edit Folder":"Create New Folder"))])]),s("v-card-text",[s("v-text-field",{ref:"folderName",attrs:{autofocus:"",label:"Folder Name"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),s("girder-breadcrumb",e._b({staticClass:"mb-3",attrs:{readonly:""}},"girder-breadcrumb",{location:e.location,append:e.append},!1)),s("girder-markdown-editor",{attrs:{label:"Description (Optional)"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}}),s("v-alert",{attrs:{type:"error",value:!!e.error,dismissible:"",transition:"scale-transition"}},[e._v(e._s(e.error))])],1),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{text:""},on:{click:function(t){return e.$emit("dismiss")}}},[e._v("Cancel")]),s("v-btn",{attrs:{depressed:"",color:"primary",type:"submit",disabled:!e.name}},[e._v(e._s(e.edit?"Save Changes":"Create Folder"))])],1)],2)],1)],1)},_t=[],xt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"girder-markdown-editor"},[s("v-tabs",{staticClass:"md-tab",model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[s("v-tab",{key:"edit"},[e._v("Edit")]),s("v-tab-item",[s("v-textarea",{attrs:{"hide-details":"",filled:"","single-line":"",label:e.label,placeholder:e.placeholder},model:{value:e.text_,callback:function(t){e.text_=t},expression:"text_"}})],1),s("v-tab",{key:"preview"},[e._v("Preview")]),s("v-tab-item",{staticClass:"md-preview pa-2 grey lighten-3"},[s("girder-markdown",{attrs:{text:e.text_}})],1)],1),s("v-toolbar",{attrs:{dark:"",color:"secondary darken-2"}},[s("span",{staticClass:"hidden-xs-only"},[e._v("Supports"),s("a",{attrs:{href:"https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet"}},[e._v(" Markdown")])]),s("v-spacer"),s("v-toolbar-items",[s("v-btn",{class:{active:0===e.activeTab},attrs:{text:""},on:{click:function(t){e.activeTab=0}}},[s("v-row",{staticClass:"flex-column align-center justify-content",attrs:{"no-gutters":""}},[s("v-icon",{staticClass:"mdi-24px"},[e._v("$vuetify.icons.edit")]),s("span",{staticClass:"caption text-capitalize"},[e._v("Write")])],1)],1),s("v-btn",{class:{active:1===e.activeTab},attrs:{text:""},on:{click:function(t){e.activeTab=1}}},[s("v-row",{staticClass:"flex-column align-center justify-content",attrs:{"no-gutters":""}},[s("v-icon",{staticClass:"mdi-24px"},[e._v("$vuetify.icons.preview")]),s("span",{staticClass:"caption text-capitalize"},[e._v("Preview")])],1)],1)],1)],1)],1)},kt=[],Ct={components:{GirderMarkdown:yt},model:{prop:"text",event:"changed"},props:{placeholder:{default:null,type:String},text:{default:"",type:String},label:{type:String,default:""}},data(){return{activeTab:0,text_:this.text}},watch:{text(){this.text_=this.text},text_(){this.$emit("changed",this.text_)}}},$t=Ct,St=(s("0e3a"),s("a844")),Tt=s("71d9"),Rt=s("2a7f"),Vt=Object(f["a"])($t,xt,kt,!1,null,null,null),jt=Vt.exports;v()(Vt,{VBtn:b["a"],VIcon:w["a"],VRow:Ye["a"],VSpacer:P["a"],VTab:ie["a"],VTabItem:oe["a"],VTabs:ne["a"],VTextarea:St["a"],VToolbar:Tt["a"],VToolbarItems:Rt["a"]});const Ot="folder";var Pt={components:{GirderBreadcrumb:Fe,GirderMarkdownEditor:jt},props:{location:{type:Object,required:!0,validator:je(!1)},edit:{type:Boolean,default:!1},preUpsert:{type:Function,default:()=>{}},postUpsert:{type:Function,default:()=>{}}},inject:["girderRest"],data(){return{name:"",description:"",error:""}},computed:{append(){return this.edit?[]:[this.name||"New Folder"]}},mounted(){this.edit&&this.loadFolder(this.location._id)},methods:{async upsert(){this.error="";try{await this.preUpsert(),this.edit?await this.girderRest.put(`${Ot}/${this.location._id}`,Object(J["stringify"])({name:this.name,description:this.description})):await this.girderRest.post(Ot,Object(J["stringify"])({parentType:this.location._modelType,parentId:this.location._id,name:this.name,description:this.description,reuseExisting:!1})),await this.postUpsert(),this.name="",this.description="",this.$emit("done")}catch(e){this.$emit("error",{type:"upsert",error:e}),this.setError(e)}},async loadFolder(e){this.error="";try{const{data:s}=await this.girderRest.get(`${Ot}/${e}`);this.name=s.name,this.description=s.description}catch(t){this.$emit("error",{type:"load",error:t}),this.setError(t)}},setError(e){if(e.response){const{data:t={}}=e.response,{type:s="unknown",message:a,field:r="unknown"}=t;this.error=`${s} error on ${r}: ${a||e.message}`}else this.error=`Unknown error: ${e.message}`}}},Et=Pt,It=Object(f["a"])(Et,wt,_t,!1,null,null,null),Lt=It.exports;function Ft(e,t,s,a=""){if(["resource","folder","item","file"].indexOf(t)<0)throw new Error(`${t} is not downloadable`);const r=s?`${s}/`:"",i=`${e}/${t}/${r}download${a}`;window.open(i,"_blank")}v()(It,{VAlert:R["a"],VBtn:b["a"],VCard:re["a"],VCardActions:V["a"],VCardText:V["b"],VCardTitle:V["c"],VForm:O["a"],VRow:Ye["a"],VSpacer:P["a"],VTextField:E["a"]});const Dt=[{value:"size",name:"Size: ",transform:ge.methods.formatSize},{value:"created",name:"Created on ",transform:fe.methods.formatDate},{value:"updated",name:"Updated on ",transform:fe.methods.formatDate},{value:"_id",name:"Unique ID: "}],Mt=[{for:["item"],name:"View Item",iconKey:"view",color:"primary",handler(){const{value:e}=this;Ft(this.girderRest.apiRoot,e[0]._modelType,e[0]._id,"?contentDisposition=inline")}},{for:["item"],name:"Download",iconKey:"download",color:"secondary",handler(){const{value:e}=this;Ft(this.girderRest.apiRoot,e[0]._modelType,e[0]._id)}},{for:["folder","multi"],name:"Download (zip)",iconKey:"download",color:"secondary",handler(){const{value:e}=this,t={item:[],folder:[]};e.forEach(e=>t[e._modelType].push(e._id)),Ft(this.girderRest.apiRoot,"resource",null,`?resources=${JSON.stringify(t)}`)}},{for:["item","folder","multi"],name:"Delete",iconKey:"delete",color:"error",async handler(){const{value:e}=this,t={item:[],folder:[]};e.forEach(e=>t[e._modelType].push(e._id)),await this.girderRest.delete("resource",{params:{resources:JSON.stringify(t)}})}}];var Ut={components:{GirderDetailList:ut,GirderMarkdown:yt,GirderUpsertFolder:Lt},mixins:[ge,be],props:{value:{required:!0,type:Array},infoKeys:{type:Array,default:()=>Dt},actionKeys:{type:Array,default:()=>Mt}},data(){return{showUpsert:!1}},inject:["girderRest"],asyncComputed:{async details(){if(this.datum&&this.datum.created)return this.datum;if(this.datum){const{data:e}=await this.girderRest.get(`${this.value[0]._modelType}/${this.value[0]._id}`);return e}return null},files:{default:[],async get(){if(this.datum&&"item"===this.datum._modelType){const{data:e}=await this.girderRest.get(`item/${this.datum._id}/files`);return e.map(e=>e.name)}return[]}}},computed:{title(){return this.details?this.details.name||this.formatUsername(this.details):`${this.value.length} Selection(s)`},datum(){return 1===this.value.length?this.value[0]:void 0},icon(){return this.datum?this.$vuetify.icons.values[this.datum._modelType]:this.$vuetify.icons.values.fileMultiple},meta(){return this.details&&"meta"in this.details?Object.entries(this.details.meta).map(([e,t])=>({key:e,value:t})):[]},info(){if(this.details)return this.infoKeys.map(e=>{let t=this.details[e.value];return e.transform&&(t=e.transform(t)),`${e.name}${t}`});if(this.value.length>1){const e=(e,t)=>{return e[t._modelType]+=1,e.size+=t.size,e},t=this.value.reduce(e,{item:0,folder:0,size:0}),s=["item","folder"].filter(e=>t[e]>0).map(e=>`${t[e]} ${e}(s) selected`),a=`Total size: ${this.formatSize(t.size)}`;return[...s,a]}return[]},actions(){const e=this.datum?this.datum._modelType:"multi";return this.actionKeys.filter(t=>t.for.includes(e))}},methods:{async handleAction(e){await e.handler.apply(this),this.$emit("action",e)}}},zt=Ut,Nt=s("62ad"),Bt=s("169a"),At=s("34c3"),qt=Object(f["a"])(zt,et,tt,!1,null,null,null),Gt=qt.exports;v()(qt,{VBtn:b["a"],VCard:re["a"],VCol:Nt["a"],VDialog:Bt["a"],VIcon:w["a"],VListItemContent:lt["a"],VListItemIcon:At["a"],VRow:Ye["a"],VSpacer:P["a"],VToolbar:Tt["a"],VToolbarTitle:Rt["b"]});var Jt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-card",{staticClass:"job-filter",attrs:{dark:"",color:"primary"}},[s("v-card-title",[s("v-container",[s("h4",[e._v("Girder Worker Jobs")]),s("v-row",{attrs:{justify:"center"}},[s("v-col",{attrs:{sm:"5",md:"4"}},[s("v-select",{attrs:{label:"Job Type",items:e.jobTypeList,value:e.jobType,clearable:"",color:"white","menu-props":{"content-class":"girder-job-filter-form-menu"},dense:""},on:{input:function(t){return e.$emit("update:jobType",t||null)}}})],1),s("v-col",{attrs:{sm:"5",md:"4"}},[s("v-select",{attrs:{label:"Status",items:e.statusItemList,value:e.status,clearable:"",color:"white","menu-props":{"content-class":"girder-job-filter-form-menu"},dense:""},on:{input:function(t){return e.$emit("update:status",t||null)}}})],1)],1)],1)],1)],1)},Kt=[];const Wt={INACTIVE:{value:0,text:"Inactive",icon:"mdi-pause",color:"grey lighten-1"},QUEUED:{value:1,text:"Queued",icon:"mdi-dots-horizontal",color:"yellow darken-2",indeterminate:!0},RUNNING:{value:2,text:"Running",icon:"mdi-autorenew",color:"light-blue",spin:!0},SUCCESS:{value:3,text:"Success",icon:"mdi-check-circle",color:"green"},ERROR:{value:4,text:"Error",icon:"mdi-alert-circle",color:"red"},CANCELED:{value:5,text:"Canceled",icon:"mdi-close-circle",color:"grey darken-1"},WORKER_FETCHING_INPUT:{value:820,text:"Fetching input",icon:"mdi-cloud-download",color:"light-blue lighten-2",indeterminate:!0},WORKER_CONVERTING_INPUT:{value:821,text:"Converting input",icon:"mdi-shuffle",color:"lime",indeterminate:!0},WORKER_CONVERTING_OUTPUT:{value:822,text:"Converting output",icon:"mdi-shuffle",color:"lime",indeterminate:!0},WORKER_PUSHING_OUTPUT:{value:823,text:"Pushing output",icon:"mdi-cloud-upload",color:"light-blue lighten-2",indeterminate:!0},WORKER_CANCELING:{value:824,text:"Canceling",icon:"mdi-alert",color:"grey darken-1",indeterminate:!0}};function Ht(e){return Object.values(Wt).find(t=>t.value===e)}var Qt={props:{jobType:{type:[String,Object],default:null},jobTypeList:{type:Array,default(){return[]}},status:{type:[Number,Object],default:null},statusList:{type:Array,default(){return[]}}},data(){return{fromDateMenu:!1,toDateMenu:!1}},computed:{statusItemList(){return this.statusList.map(Ht).filter(e=>e&&e.text).sort((e,t)=>{return e.text>t.text?1:e.text<t.text?-1:0})}}},Yt=Qt,Xt=s("b974"),Zt=Object(f["a"])(Yt,Jt,Kt,!1,null,null,null),es=Zt.exports;v()(Zt,{VCard:re["a"],VCardTitle:V["c"],VCol:Nt["a"],VContainer:y["a"],VRow:Ye["a"],VSelect:Xt["a"]});var ts=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-card",{staticClass:"girder-job-list",attrs:{color:"primary"}},[s("filter-form",{attrs:{"from-date":e.jobFilter.fromDate,"to-date":e.jobFilter.toDate,status:e.jobFilter.status,"job-type":e.jobFilter.jobType,"status-list":e.typeAndStatusList.statuses,"job-type-list":e.typeAndStatusList.types},on:{"update:fromDate":function(t){return e.$set(e.jobFilter,"fromDate",t)},"update:from-date":function(t){return e.$set(e.jobFilter,"fromDate",t)},"update:toDate":function(t){return e.$set(e.jobFilter,"toDate",t)},"update:to-date":function(t){return e.$set(e.jobFilter,"toDate",t)},"update:status":function(t){return e.$set(e.jobFilter,"status",t)},"update:jobType":function(t){return e.$set(e.jobFilter,"jobType",t)},"update:job-type":function(t){return e.$set(e.jobFilter,"jobType",t)}}}),s("job-table",{attrs:{jobs:e.jobs,options:e.options,"more-pages":e.morePages},on:{"update:options":function(t){e.options=t},"job-click":function(t,s){return e.$emit("job-click",t,s)}},scopedSlots:e._u([e.$scopedSlots.jobwidget?{key:"jobwidget",fn:function(t){return[e._t("jobwidget",null,null,t)]}}:null],null,!0)})],1)},ss=[],as=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-data-table",{attrs:{"item-key":"_id",headers:e.headers_,items:e.items,"server-items-length":e.serverItemsLength,options:e.options},on:{"update:options":function(t){return e.$emit("update:options",t)}},scopedSlots:e._u([{key:"item",fn:function(t){return[s("tr",{on:{click:function(s){return e.$emit("job-click",s,t.item)}}},[s("td",{staticClass:"one-line"},[e._v(e._s(t.item.title))]),s("td",{staticClass:"one-line"},[e._v(e._s(t.item.type))]),s("td",{staticClass:"one-line"},[e._v(e._s(t.item.updateString))]),s("td",{staticClass:"one-line status-line",attrs:{nowrap:"",title:t.item.statusText,width:"1%"}},[s("v-row",{staticClass:"flex-nowrap ma-2",attrs:{align:"center"}},[s("v-progress-linear",{staticClass:"progress-bar mr-3",attrs:{color:t.item.statusColor,value:t.item.progressNumber,indeterminate:!!t.item.indeterminate,height:"10"}}),s("v-icon",{staticClass:"status-icon",class:{rotate:t.item.spin},attrs:{color:t.item.statusColor,size:20}},[e._v(e._s(t.item.statusIcon))])],1)],1),s("td",{staticClass:"one-line pa-0"},[e._t("jobwidget",null,null,t)],2)])]}},{key:"footer.page-text",fn:function(){return[s("div",{staticClass:"v-datatable__actions__options"},[e._v(e._s(e.pageRange.first)+"-"+e._s(e.pageRange.last))])]},proxy:!0}],null,!0)})},rs=[],is=s("c1df"),os=s.n(is),ns={props:{jobs:{type:Array,required:!0},options:{type:Object,required:!0},morePages:{type:Boolean,default:!0}},data(){return{headers:[{text:"Job Title",value:"title"},{text:"Type",value:"type"},{text:"Last Updated",value:"updated"},{text:"Status",value:"status"}]}},computed:{items(){return this.jobs.map(this.mapJobToRow)},headers_(){const e={sortable:!1,align:"end"};return this.headers.concat(this.$scopedSlots.jobwidget?e:[])},serverItemsLength(){let{last:e}=this.pageRange;return this.morePages&&(e+=1),e},pageRange(){const e=this.options.itemsPerPage*(this.options.page-1)+1,t=e+this.jobs.length-1;return{first:e,last:t}}},methods:{mapJobToRow(e){const t=Object.assign({text:"Unknown"},Ht(e.status));return Object.assign({statusText:t.text,statusColor:t.color,statusTextColor:t.textColor||"white",statusIcon:t.icon,updateString:os()(e.updated).format("dddd, MMMM D, YYYY @ h:mm a"),progressNumber:this.progressAsNumber(e.progress),indeterminate:t.indeterminate,spin:t.spin},e)},progressAsNumber(e){return e?e.current/e.total*100:100}}},ls=ns,cs=(s("4021"),s("8e36")),ds=Object(f["a"])(ls,as,rs,!1,null,"09207ca3",null),us=ds.exports;v()(ds,{VDataTable:qe["a"],VIcon:w["a"],VProgressLinear:cs["a"],VRow:Ye["a"]});var ps={inject:["girderRest","notificationBus"],components:{JobTable:us,FilterForm:es},data(){return{jobFilter:{fromDate:null,toDate:null,status:null,jobType:null},options:{itemsPerPage:10,page:1,sortBy:["updated"],descending:!0},morePages:!0,refresh:0}},watch:{jobFilter:{handler(){this.options.page=1},deep:!0}},asyncComputed:{jobs:{async get(){this.girderRest.user,this.refresh;const e=this.options,t={limit:e.itemsPerPage+1,offset:e.itemsPerPage*(e.page-1)};e.sortBy&&(t.sort=e.sortBy,t.sortdir=e.descending?-1:1),null!==this.jobFilter.status&&(t.statuses=JSON.stringify([this.jobFilter.status])),null!==this.jobFilter.jobType&&(t.types=JSON.stringify([this.jobFilter.jobType]));const s=await this.girderRest.get(`job?${Object(J["stringify"])(t)}`);return s.data.length<t.limit?this.morePages=!1:this.morePages=!0,s.data.slice(0,e.itemsPerPage)},default(){return[]}},typeAndStatusList:{async get(){this.girderRest.user;const e=await this.girderRest.get("job/typeandstatus");return e.data},default(){return{statuses:[],types:[]}}}},mounted(){this.refreshJobFunc=()=>{this.refreshJobList()},this.notificationBus.$on("message:job_status",this.refreshJobFunc),this.notificationBus.$on("message:job_created",this.refreshJobFunc)},beforeDestroy(){this.notificationBus.$off("message:job_status",this.refreshJobFunc),this.notificationBus.$off("message:job_created",this.refreshJobFunc)},methods:{refreshJobList(){this.refresh+=1}}},hs=ps,ms=Object(f["a"])(hs,ts,ss,!1,null,null,null),fs=ms.exports;v()(ms,{VCard:re["a"]});var gs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-row",{staticClass:"align-center girder-searchbar",attrs:{"no-gutters":""}},[s("v-icon",{staticClass:"mdi-24px",attrs:{color:"white"}},[e._v("$vuetify.icons.search")]),s("v-menu",{staticClass:"mx-2",attrs:{"offset-y":"","content-class":"girder-searchbar-menu",transition:"slide-y-transition","open-on-click":!1,value:e.searchText,"nudge-bottom":6},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[s("v-text-field",e._g({attrs:{light:"",solo:"","hide-details":"",clearable:"",placeholder:e.placeholder},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},a))]}}])},[s("v-list",{attrs:{dense:""}},[e._l(e.quickResults,function(t){return s("v-list-item",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],key:t._id,on:{click:function(s){return e.selectResult(t)}}},[e._t("searchresult",[s("v-list-item-action",{staticClass:"mr-2"},[s("v-icon",[e._v(e._s(e.$vuetify.icons.values[t._modelType]))])],1),s("v-list-item-content",[s("v-list-item-title",[e._v(e._s(t.name||e.formatUsername(t)))])],1)],null,t)],2)}),s("v-list-item",{directives:[{name:"show",rawName:"v-show",value:e.searchText&&0===e.quickResults.length&&!e.loading,expression:"searchText && quickResults.length === 0 && !loading"}]},[s("v-list-item-action",[s("v-icon",[e._v("$vuetify.icons.alert")])],1),s("v-list-item-content",[s("v-list-item-title",[e._v("No results found for query '"+e._s(e.searchText)+"'")]),s("v-list-item-subtitle",[e._v("Modify search parameters or refine your query.")])],1)],1),s("v-list-item",{directives:[{name:"show",rawName:"v-show",value:!e.loading&&e.showMore&&e.searchResults.length>e.maxQuickResults,expression:"!loading && showMore && searchResults.length > maxQuickResults"}],on:{click:function(t){return e.$emit("moreresults",e.searchParams)}}},[s("v-list-item-action",[s("v-icon",[e._v("$vuetify.icons.more")])],1),s("v-list-item-content",[s("v-list-item-title",[e._v("More")])],1)],1),e._l(e.maxQuickResults+(e.showMore?1:0),function(t){return s("v-list-item",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],key:"skeleton-"+t},[s("v-list-item-action",[s("v-icon",{staticClass:"grey--text text--lighten-1"},[e._v("$vuetify.icons.circle")])],1),s("v-list-item-content",[s("v-list-item-title",{staticClass:"skeleton skeleton--text mb-2",style:{maxWidth:70+t%3*4+"%",height:"12px"}}),s("v-list-item-subtitle",{staticClass:"skeleton skeleton--text",style:{maxWidth:50-t%2*4+"%",height:"6px"}})],1)],1)})],2)],1),e.hideOptionsMenu?e._e():s("v-menu",{attrs:{"offset-y":"",left:"","content-class":"girder-search-arrow-menu","close-on-content-click":!1},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[s("v-btn",e._g({attrs:{icon:""}},a),[s("v-icon",{staticClass:"mdi-24px"},[e._v("$vuetify.icons.settings")])],1)]}}],null,!1,2789432402),model:{value:e.searchOptionsMenu,callback:function(t){e.searchOptionsMenu=t},expression:"searchOptionsMenu"}},[s("v-card",[s("v-card-actions",[s("v-col",{staticClass:"pa-0 flex-column",attrs:{"no-gutters":""}},[s("v-radio-group",{staticClass:"my-2",attrs:{"hide-details":""},model:{value:e.internalSearchMode,callback:function(t){e.internalSearchMode=t},expression:"internalSearchMode"}},e._l(e.searchModeOptions,function(e){return s("v-radio",{key:e.value,staticClass:"mb-1",attrs:{label:e.name,value:e.value}})}),1),s("v-divider"),e._l(e.searchTypeOptions,function(t){return s("v-checkbox",{key:t.value,staticClass:"mt-1",attrs:{"hide-details":"",label:t.name,value:t.value},model:{value:e.internalSearchTypes,callback:function(t){e.internalSearchTypes=t},expression:"internalSearchTypes"}})})],2)],1)],1)],1)],1)},vs=[];const bs=[{name:"Prefix Search",value:"prefix"},{name:"Text Search",value:"text"}],ys=bs[0].value,ws=[{name:"User",value:"user"},{name:"Folder",value:"folder"},{name:"Item",value:"item"}],_s=ws.map(e=>e.value);var xs={mixins:[be],props:{hideOptionsMenu:{type:Boolean,default:!1},maxQuickResults:{type:Number,default:6},placeholder:{type:String,default:null},searchModeOptions:{type:Array,default:()=>bs},searchMode:{type:String,default:null},searchTypeOptions:{type:Array,default:()=>ws},searchTypes:{validator:e=>Array.isArray(e)||null===e,default:null},showMore:{type:Boolean,default:!1}},inject:["girderRest"],data(){return{searchText:"",lazySearchMode:this.searchMode||ys,lazySearchTypes:this.searchTypes||_s,searchOptionsMenu:!1}},computed:{loading(){return this.counter.flag},quickResults(){return this.searchResults.slice(0,this.maxQuickResults)},searchParams(){return{q:this.searchText,mode:this.internalSearchMode,types:JSON.stringify(this.internalSearchTypes),limit:this.maxQuickResults+1}},internalSearchMode:{get(){return this.lazySearchMode},set(e){this.lazySearchMode=e,this.$emit("update:searchMode",e)}},internalSearchTypes:{get(){return this.lazySearchTypes},set(e){this.lazySearchTypes=e,this.$emit("update:searchTypes",e)}}},watch:{searchMode(e){this.lazySearchMode=e||ys},searchTypes(e){this.lazySearchTypes=e||_s}},asyncComputed:{searchResults:{default:[],async get(){let e=[];this.counter.inc();try{if(this.searchText){const{data:t}=await this.girderRest.get("resource/search",{params:this.searchParams});e=[].concat(...this.internalSearchTypes.map(e=>t[e]))}}catch(t){this.$emit("error",t.message||"Unknown error during search")}return this.counter.dec(),e}}},beforeCreate(){this.counter=new Se},methods:{selectResult(e){this.searchText="",this.$emit("select",e)}}},ks=xs,Cs=(s("e589"),s("3ccc"),s("1800")),$s=s("e449"),Ss=s("67b6"),Ts=s("43a6"),Rs=Object(f["a"])(ks,gs,vs,!1,null,"24020fac",null),Vs=Rs.exports;v()(Rs,{VBtn:b["a"],VCard:re["a"],VCardActions:V["a"],VCheckbox:Ae["a"],VCol:Nt["a"],VDivider:j["a"],VIcon:w["a"],VList:ot["a"],VListItem:nt["a"],VListItemAction:Cs["a"],VListItemContent:lt["a"],VListItemSubtitle:lt["b"],VListItemTitle:lt["c"],VMenu:$s["a"],VRadio:Ss["a"],VRadioGroup:Ts["a"],VRow:Ye["a"],VTextField:E["a"]});var js=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-card",{staticClass:"fill-height",attrs:{flat:""}},[s("v-row",{staticClass:"flex-column fill-height",attrs:{"no-gutters":""}},[e._t("header",[s("v-card-title",{attrs:{"primary-title":""}},[s("div",[s("div",{staticClass:"headline"},[e._v("Upload to "),s("span",{staticClass:"font-weight-bold"},[e._v(e._s(e.dest.name))])]),s("div",{staticClass:"grey--text title"},[e._v(e._s(e.statusMessage))])])])]),e.uploading?s("v-progress-linear",{attrs:{value:e.totalProgressPercent,height:"20"}}):e._e(),s("v-card-actions",{directives:[{name:"show",rawName:"v-show",value:e.files.length&&!e.errorMessage&&!e.uploading,expression:"files.length && !errorMessage && !uploading"}]},[s("v-btn",{attrs:{text:""},on:{click:function(t){e.files=[]}}},[e._v("Clear all")]),s("v-btn",{attrs:{text:"",color:"primary"},on:{click:e.start}},[e._v(e._s(e.startButtonText))])],1),s("v-col",[e._t("dropzone",[e.files.length?e._e():s("dropzone",{attrs:{message:e.dropzoneMessage,multiple:e.multiple,accept:e.accept},on:{change:e.inputFilesChanged}})])],2),e.errorMessage?s("div",[s("v-alert",{attrs:{value:!0,dark:"",type:"error"}},[e._v(e._s(e.errorMessage)),e.uploading?e._e():s("v-btn",{attrs:{dark:"",outlined:""},on:{click:e.start}},[e._v("Resume upload")])],1)],1):e._e(),e._t("files",[s("file-upload-list",e._b({on:{input:e.setFiles}},"file-upload-list",{value:e.files,currentIndex:e.currentIndex,maxShow:e.maxShow},!1))],null,{files:e.files,setFiles:e.setFiles,currentIndex:e.currentIndex,maxShow:e.maxShow})],2)],1)},Os=[],Ps=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"dropzone-wrapper",class:e.dropzoneClass,on:{dragenter:function(t){e.dropzoneClass="animate"},dragleave:function(t){e.dropzoneClass=null},drop:function(t){e.dropzoneClass=null}}},[s("v-row",{staticClass:"flex-column align-center justify-center fill-height dropzone-message"},[s("v-icon",{attrs:{size:"50px"}},[e._v("$vuetify.icons.fileUpload")]),s("div",{staticClass:"title mt-3"},[e._v(e._s(e.message))])],1),s("input",{staticClass:"file-input",attrs:{type:"file",multiple:e.multiple,accept:e.accept},on:{change:function(t){e.$emit("change",Array.apply(void 0,t.target.files))}}})],1)},Es=[],Is={props:{message:{type:String,required:!0},multiple:{type:Boolean,required:!0},accept:{type:String,default:null}},data(){return{dropzoneClass:null}}},Ls=Is,Fs=(s("c005"),Object(f["a"])(Ls,Ps,Es,!1,null,"12b18042",null)),Ds=Fs.exports;v()(Fs,{VIcon:w["a"],VRow:Ye["a"]});var Ms=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-list",{directives:[{name:"show",rawName:"v-show",value:e.value.length,expression:"value.length"}],attrs:{dense:""}},[e._l(e.shownFiles,function(t,a){return s("div",{key:t.file.name,staticClass:"file-tile",class:"status-"+t.status},[a>0?s("v-divider"):e._e(),s("v-list-item",[s("v-list-item-icon",["pending"===t.status?s("v-btn",{attrs:{icon:""},on:{click:function(t){e.$emit("input",e.splice(a))}}},[s("v-icon",[e._v("$vuetify.icons.close")])],1):e._e(),"uploading"===t.status?s("v-progress-circular",{attrs:{color:"primary",rotate:-90,value:e.progressPercent(Object.assign({},t.progress,{total:t.progress.size})),indeterminate:t.progress.indeterminate}}):e._e(),"done"===t.status?s("v-icon",{attrs:{color:"success",large:""}},[e._v("$vuetify.icons.complete")]):e._e(),"error"===t.status?s("v-icon",{attrs:{color:"error",large:""}},[e._v("$vuetify.icons.error")]):e._e()],1),s("v-list-item-content",[s("v-list-item-title",[e._v(e._s(t.file.name))]),s("v-list-item-subtitle",[t.progress.current?s("span",[e._v(e._s(e.formatSize(t.progress.current))+" /")]):e._e(),s("span",[e._v(e._s(e.formatSize(t.file.size)))])])],1),e._t("item",null,null,{file:t})],2)],1)}),e.hiddenCount?[s("v-divider"),s("v-list-item",[s("v-list-item-content",[s("div",{staticClass:"grey--text subtitle-1"},[e._v("+ "+e._s(e.hiddenCount)+" more...")])])],1)]:e._e()],2)},Us=[],zs={mixins:[ve,ge],props:{value:{type:Array,required:!0},maxShow:{type:Number,default:0},currentIndex:{type:Number,default:0}},computed:{shownFiles(){return this.maxShow?this.value.slice(this.currentIndex,this.maxShow+this.currentIndex):this.value},hiddenCount(){return this.maxShow?Math.max(this.value.length-this.maxShow-this.currentIndex,0):0}},methods:{splice(e){return[...this.value.slice(0,e),...this.value.slice(e+1)]}}},Ns=zs,Bs=(s("c27d"),s("490a")),As=Object(f["a"])(Ns,Ms,Us,!1,null,"ae1a0400",null),qs=As.exports;v()(As,{VBtn:b["a"],VDivider:j["a"],VIcon:w["a"],VList:ot["a"],VListItem:nt["a"],VListItemContent:lt["a"],VListItemIcon:At["a"],VListItemSubtitle:lt["b"],VListItemTitle:lt["c"],VProgressCircular:Bs["a"]});var Gs={components:{Dropzone:Ds,FileUploadList:qs},mixins:[ve,ge],inject:["girderRest"],props:{dest:{required:!0,type:Object},maxShow:{default:0,type:Number},multiple:{default:!0,type:Boolean},preUpload:{default:()=>{},type:Function},postUpload:{default:()=>{},type:Function},uploadCls:{default:$e,type:Function},accept:{default:null,type:String},startButtonText:{default:"Start Upload",type:String}},data:()=>({dragover:!1,errorMessage:null,files:[],uploading:!1,currentIndex:0}),computed:{dropzoneMessage(){return this.multiple?"Drag files here or click to select them":"Drag a file here or click to select one"},statusMessage(){return this.uploading?`${this.formatSize(this.totalProgress)} / ${this.formatSize(this.totalSize)} `+`(${this.totalProgressPercent}%)`:`${this.files.length} selected (${this.formatSize(this.totalSize)} total)`},totalProgress(){return this.files.reduce((e,t)=>e+t.progress.current,0)},totalSize(){return this.files.reduce((e,t)=>e+t.file.size,0)},totalProgressPercent(){return this.progressPercent({current:this.totalProgress,total:this.totalSize})}},watch:{files(e){this.$emit("filesChanged",e)}},methods:{inputFilesChanged(e){this.currentIndex=0,this.files=e.map(e=>({file:e,status:"pending",progress:{indeterminate:!1,current:0,size:e.size},upload:null,result:null}))},setFiles(e){this.currentIndex>=e.length&&(this.currentIndex=e.length-1),this.files=e},async start(){const e=[];for(this.uploading=!0,this.errorMessage=null,await this.preUpload();this.currentIndex<this.files.length;this.currentIndex+=1){const s=this.files[this.currentIndex];if("done"===s.status)e.push(s.result);else{const a=e=>{Object.assign(s.progress,e)};s.status="uploading",s.progress.indeterminate=!0;try{s.upload?s.result=await s.upload.resume():(s.upload=new this.uploadCls(s.file,{$rest:this.girderRest,parent:this.dest,progress:a}),await s.upload.beforeUpload(),s.result=await s.upload.start()),await s.upload.afterUpload(),delete s.upload,e.push(s.result),s.status="done",s.progress.current=s.file.size}catch(t){return await s.upload.onError(t),t.response?this.errorMessage=t.response.data.message||"An error occurred during upload.":this.errorMessage="Connection failed.",s.status="error",this.uploading=!1,void this.$emit("error",{error:t,file:s})}}}await this.postUpload(),this.uploading=!1,this.files=[],this.$emit("done",e)}}},Js=Gs,Ks=Object(f["a"])(Js,js,Os,!1,null,null,null),Ws=Ks.exports;function Hs(e){e.use(i["a"]),e.use(r["a"])}v()(Ks,{VAlert:R["a"],VBtn:b["a"],VCard:re["a"],VCardActions:V["a"],VCardTitle:V["c"],VCol:Nt["a"],VProgressLinear:cs["a"],VRow:Ye["a"]});const Qs=new i["a"]({...we});var Ys={install:Hs};class Xs extends a["a"]{constructor(e,{EventSource:t=window.EventSource,listenToRestClient:s=!0,pollingInterval:a=[500,5e3,1e3],since:r=new Date,useEventSource:i=!1,withCredentials:o=!0}={}){super(),Object.assign(this,{$rest:e,EventSource:t,pollingInterval:a,since:r,useEventSource:i,withCredentials:o}),s&&(e.$on("login",()=>{this.connect()}),e.$on("logout",()=>{this.disconnect()}))}_emitNotification(e){const{type:t,updated:s}=e;s&&(this.since=new Date(Math.max(+this.since,+new Date(s))));for(let a=t.indexOf(".");-1!==a;a=t.indexOf(".",a+1))this.$emit(`message:${t.substring(0,a)}`,e,this);this.$emit(`message:${t}`,e,this),this.$emit("message",e,this)}_onSseMessage({data:e}){this._emitNotification(JSON.parse(e))}_onSseError(e){this.$emit("error",e,this),this.disconnect(),this.useEventSource=!1,this.connect()}get connected(){return!(!this._eventSource&&!this._poller)}connect(){if(!this.connected)if(this.useEventSource&&this.EventSource){const e=Math.ceil(+this.since/1e3),t=`${this.$rest.apiRoot}/notification/stream?since=${e}`;this._eventSource=new this.EventSource(t,{withCredentials:this.withCredentials}),this._eventSource.onmessage=this._onSseMessage.bind(this),this._eventSource.onerror=this._onSseError.bind(this),this.$emit("start",this)}else this._poll()}disconnect(){this._stopPolling(),this._eventSource&&(this._eventSource.close(),this._eventSource=null,this.$emit("stop",this))}_poll(e=0){const[t,s,a]=this.pollingInterval;let r;this._poller=setTimeout(async()=>{try{const{data:o}=await this.$rest.get(`/notification?since=${this.since.toISOString()}`);o.forEach(this._emitNotification.bind(this)),r=o.length?t:0===e?s:Math.min(e+a,s)}catch(i){r=s}finally{this._poll(r)}},e)}_stopPolling(){clearTimeout(this._poller),this._poller=null}}var Zs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",{staticClass:"app"},[s("v-app-bar",{attrs:{color:"primary",dark:"",app:""}},[s("v-toolbar-title",[e._v("Girder Web Components")]),s("v-toolbar-items",[s("v-menu",{attrs:{"offset-y":"",left:"","close-on-content-click":!1,"content-class":"girder-search-arrow-menu"},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[s("v-btn",e._g({attrs:{icon:""}},a),[s("v-icon",{staticClass:"mdi-24px"},[e._v("$vuetify.icons.more")])],1)]}}]),model:{value:e.uiOptionsMenu,callback:function(t){e.uiOptionsMenu=t},expression:"uiOptionsMenu"}},[s("v-card",[s("v-card-actions",[s("v-row",[s("v-col",{staticClass:"py-0"},[s("v-checkbox",{staticClass:"mt-1",attrs:{"hide-details":"",label:"Worker Jobs"},model:{value:e.jobsEnabled,callback:function(t){e.jobsEnabled=t},expression:"jobsEnabled"}}),s("v-divider",{staticClass:"mt-2 mb-1"}),s("v-checkbox",{staticClass:"mt-1",attrs:{"hide-details":"",label:"Data Browser"},model:{value:e.browserEnabled,callback:function(t){e.browserEnabled=t},expression:"browserEnabled"}}),s("v-checkbox",{staticClass:"mt-1",attrs:{"hide-details":"",label:"Select"},model:{value:e.selectable,callback:function(t){e.selectable=t},expression:"selectable"}}),s("v-checkbox",{staticClass:"mt-1",attrs:{"hide-details":"",label:"Draggable"},model:{value:e.dragEnabled,callback:function(t){e.dragEnabled=t},expression:"dragEnabled"}}),s("v-checkbox",{staticClass:"mt-1",attrs:{"hide-details":"",label:"New Folder"},model:{value:e.newFolderEnabled,callback:function(t){e.newFolderEnabled=t},expression:"newFolderEnabled"}}),s("v-checkbox",{staticClass:"mt-1",attrs:{"hide-details":"",label:"Upload"},model:{value:e.uploadEnabled,callback:function(t){e.uploadEnabled=t},expression:"uploadEnabled"}}),s("v-checkbox",{staticClass:"mt-1",attrs:{"hide-details":"",label:"Root Disabled"},model:{value:e.rootLocationDisabled,callback:function(t){e.rootLocationDisabled=t},expression:"rootLocationDisabled"}}),s("v-divider",{staticClass:"mt-2 mb-1"}),s("v-checkbox",{staticClass:"mt-1 mb-1",attrs:{"hide-details":"",label:"Search Box"},model:{value:e.searchEnabled,callback:function(t){e.searchEnabled=t},expression:"searchEnabled"}}),s("v-checkbox",{staticClass:"mt-1 mb-1",attrs:{"hide-details":"",label:"Dark theme"},model:{value:e.$vuetify.theme.dark,callback:function(t){e.$set(e.$vuetify.theme,"dark",t)},expression:"$vuetify.theme.dark"}})],1)],1)],1)],1)],1)],1),s("v-spacer"),e.searchEnabled?s("girder-search",{on:{select:e.handleSearchSelect}}):e._e(),e.loggedOut?e._e():s("v-btn",{attrs:{text:"",icon:""},on:{click:function(t){return e.girderRest.logout()}}},[s("v-icon",[e._v("$vuetify.icons.logout")])],1)],1),s("v-content",[s("v-container",[s("v-row",[e.loggedOut?s("v-col",{attrs:{lg:"4",md:"5",sm:"12"}},[s("girder-auth",{key:e.girderRest.token,attrs:{"force-otp":!1,register:!0,oauth:!0,"forgot-password-url":e.forgotPasswordUrl}})],1):e._e(),s("v-col",[e.browserEnabled?s("girder-file-manager",{ref:"girderFileManager",staticClass:"mb-3",attrs:{"drag-enabled":e.dragEnabled,"new-folder-enabled":e.newFolderEnabled,selectable:e.selectable,location:e.location,"root-location-disabled":e.rootLocationDisabled,"upload-multiple":e.uploadMultiple,"upload-enabled":e.uploadEnabled},on:{"update:location":function(t){e.location=t}},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}):e._e(),e.jobsEnabled?s("girder-job-list"):e._e()],1),s("v-col",{staticStyle:{"max-width":"340px"}},[s("girder-data-details",{attrs:{value:e.detailsList},on:{action:e.handleAction}})],1)],1)],1)],1)],1)},ea=[],ta=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-card",{staticClass:"girder-data-browser-snippet"},[s("girder-data-browser",{ref:"girderBrowser",attrs:{location:e.internalLocation,selectable:e.selectable,draggable:e.dragEnabled,"root-location-disabled":e.rootLocationDisabled,value:e.value},on:{"update:location":function(t){e.internalLocation=t},input:function(t){return e.$emit("input",t)},"selection-changed":function(t){return e.$emit("selection-changed",t)},rowclick:function(t){return e.$emit("rowclick",t)},drag:function(t){return e.$emit("drag",t)},dragstart:function(t){return e.$emit("dragstart",t)},dragend:function(t){return e.$emit("dragend",t)},drop:function(t){return e.$emit("drop",t)}},scopedSlots:e._u([{key:"breadcrumb",fn:function(e){return[s("girder-breadcrumb",{attrs:{location:e.location,"root-location-disabled":e.rootLocationDisabled},on:{crumbclick:function(t){return e.changeLocation(t)}}})]}},{key:"headerwidget",fn:function(){return[e._t("headerwidget"),e.shouldShowUpload?s("v-dialog",{attrs:{"max-width":"800px"},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[s("v-btn",e._g({staticClass:"ma-0",attrs:{text:"",small:""}},a),[s("v-icon",{staticClass:"mdi-24px mr-1",attrs:{left:"",color:"accent"}},[e._v("$vuetify.icons.fileNew")]),s("span",{staticClass:"hidden-xs-only"},[e._v("Upload")])],1)]}}],null,!1,3152549835),model:{value:e.uploaderDialog,callback:function(t){e.uploaderDialog=t},expression:"uploaderDialog"}},[s("girder-upload",{attrs:{dest:e.uploadDest,"pre-upload":e.preUpload,"post-upload":e.postUploadInternal,multiple:e.uploadMultiple,"max-show":e.uploadMaxShow,accept:e.uploadAccept}})],1):e._e(),e.newFolderEnabled&&!e.isRootLocation(e.internalLocation)&&e.girderRest.user?s("v-dialog",{attrs:{"max-width":"800px"},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[s("v-btn",e._g({staticClass:"ma-0",attrs:{text:"",small:""}},a),[s("v-icon",{staticClass:"mdi-24px mr-1",attrs:{left:"",color:"accent"}},[e._v("$vuetify.icons.folderNew")]),s("span",{staticClass:"hidden-xs-only"},[e._v("New Folder")])],1)]}}],null,!1,1119178578),model:{value:e.newFolderDialog,callback:function(t){e.newFolderDialog=t},expression:"newFolderDialog"}},[s("girder-upsert-folder",{key:e.internalLocation._id,attrs:{location:e.internalLocation,"pre-upsert":e.preUpsert,"post-upsert":e.postUpsertInternal},on:{dismiss:function(t){e.newFolderDialog=!1}}})],1):e._e()]},proxy:!0}],null,!0)})],1)},sa=[],aa=s("5118"),ra={components:{GirderBreadcrumb:Fe,GirderUpload:Ws,GirderUpsertFolder:Lt,GirderDataBrowser:Ze},props:{value:{type:Array,default:()=>[]},location:{type:Object,validator:je(!0),default:null},rootLocationDisabled:{type:Boolean,default:!1},selectable:{type:Boolean,default:!1},dragEnabled:{type:Boolean,default:!1},uploadEnabled:{type:Boolean,default:!1},newFolderEnabled:{type:Boolean,default:!1},uploadMaxShow:{type:Number,default:0},uploadMultiple:{type:Boolean,default:!1},uploadAccept:{type:String,default:"*"},preUpload:{type:Function,default:async()=>{}},postUpload:{type:Function,default:async()=>{}},preUpsert:{type:Function,default:async()=>{}},postUpsert:{type:Function,default:async()=>{}}},inject:["girderRest"],data(){return{uploaderDialog:!1,newFolderDialog:!1,lazyLocation:null}},computed:{internalLocation:{get(){const{location:e,lazyLocation:t}=this;return e||(t||{type:"root"})},set(e){this.lazyLocation=e,this.$emit("update:location",e)}},uploadDest(){const{internalLocation:e}=this;return e&&"folder"===Te(e)?e:null},shouldShowUpload(){return this.uploadEnabled&&!Re(this.internalLocation)&&this.girderRest.user&&this.uploadDest}},created(){if(!je(!this.rootLocationDisabled)(this.internalLocation))throw new Error("root location cannot be used when root-location-disabled is true")},methods:{isRootLocation:Re,refresh(){this.$refs.girderBrowser.refresh()},postUploadInternal(){return this.$refs.girderBrowser.refresh(),this.uploaderDialog=!1,Promise.all([new Promise(e=>Object(aa["setTimeout"])(e,400)),this.postUpload()])},postUpsertInternal(){return this.$refs.girderBrowser.refresh(),this.newFolderDialog=!1,Promise.all([new Promise(e=>Object(aa["setTimeout"])(e,400)),this.postUpsert()])}}},ia=ra,oa=Object(f["a"])(ia,ta,sa,!1,null,null,null),na=oa.exports;v()(oa,{VBtn:b["a"],VCard:re["a"],VDialog:Bt["a"],VIcon:w["a"]});var la={name:"App",inject:["girderRest"],components:{GirderAuth:pe,GirderDataDetails:Gt,GirderFileManager:na,GirderSearch:Vs,GirderJobList:fs},data(){return{browserEnabled:!0,dragEnabled:!1,forgotPasswordUrl:"/#?dialog=resetpassword",jobsEnabled:!1,internalLocation:null,rootLocationDisabled:!1,searchEnabled:!0,selected:[],selectable:!0,uiOptionsMenu:!1,uploadEnabled:!0,uploadMultiple:!0,newFolderEnabled:!0}},computed:{loggedOut(){return null===this.girderRest.user},location:{get(){return this.internalLocation||(this.loggedOut?{type:"collections"}:this.girderRest.user)},set(e){this.internalLocation=e}},detailsList(){return this.selected.length?this.selected:this.location?[this.location]:[]}},methods:{handleSearchSelect(e){["user","folder"].indexOf(e._modelType)>=0?this.location=e:this.location={_modelType:"folder",_id:e.folderId}},handleAction(e){"Delete"===e.name&&(this.$refs.girderFileManager.refresh(),this.selected=[])}}},ca=la,da=(s("dfa1"),s("7496")),ua=s("40dc"),pa=s("a75b"),ha=Object(f["a"])(ca,Zs,ea,!1,null,null,null),ma=ha.exports;v()(ha,{VApp:da["a"],VAppBar:ua["a"],VBtn:b["a"],VCard:re["a"],VCardActions:V["a"],VCheckbox:Ae["a"],VCol:Nt["a"],VContainer:y["a"],VContent:pa["a"],VDivider:j["a"],VIcon:w["a"],VMenu:$s["a"],VRow:Ye["a"],VSpacer:P["a"],VToolbarItems:Rt["a"],VToolbarTitle:Rt["b"]}),a["a"].use(Ys);const fa=new te({apiRoot:"https://data.kitware.com/api/v1"}),ga=new Xs(fa);ga.connect(),fa.fetchUser().then(()=>{new a["a"]({vuetify:Qs,render:e=>e(ma),provide:{girderRest:fa,notificationBus:ga}}).$mount("#app")})},a662:function(e,t,s){},ada0:function(e,t,s){},c005:function(e,t,s){"use strict";var a=s("ada0"),r=s.n(a);r.a},c27d:function(e,t,s){"use strict";var a=s("97f4"),r=s.n(a);r.a},dfa1:function(e,t,s){"use strict";var a=s("98e3"),r=s.n(a);r.a},e589:function(e,t,s){"use strict";var a=s("406f"),r=s.n(a);r.a},e837:function(e,t,s){"use strict";var a=s("01f8"),r=s.n(a);r.a}});
//# sourceMappingURL=app.ef4e57e2.js.map